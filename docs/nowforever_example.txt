[[cha:nowforever-spindle]]

= Nowforever D100/E100 Spindle

This example shows the connections needed to use an Nowforever VFD to drive a spindle.
The spindle speed and direction is controlled by LinuxCNC.

Using the Nowforever VFD component involves very little to set up. We start with
a Stepconf Wizard generated config. Make sure the pins with "Spindle
CW" and "Spindle PWM" are set to unused in the parallel port setup
screen.

In the custom.hal file we place the following to connect LinuxCNC to the
Nowforever VFD and have LinuxCNC control the drive.

.Nowforever Example
----
# load the user space component for the Nowforever VFD
loadusr -Wn spindle-vfd nowforever_vfd -r 9600 -n spindle-vfd

# connect the spindle direction pin to the VFD 
net vfd-fwd spindle-vfd.spindle-fwd <= spindle.N.forward
net vfd-rev spindle-vfd.spindle-rev <= spindle.N.reverse

# connect the spindle on pin to the VFD 
net vfd-run spindle-vfd.spindle-on <= spindle.N.on

# connect the VFD at speed to the motion at speed 
net vfd-at-speed spindle-vfd.at-speed <= spindle.N.at-speed

# connect the spindle RPM to the VFD 
net vfd-RPM spindle-vfd.speed-command <= spindle.N.speed-out-abs
----

[NOTE]
The transmission speed might be able to be faster depending on the exact
environment. Both the drive and the command line options must match. Parameter 'modbus-errors'
shows how many transmission errors there have been in the current session. Run from terminal 
to see the modbus error codes.

On the Nowforever drive itself you need to set a couple of things before the
modbus communications will work. Other parameters might need to be set
based on your physical requirements but these are beyond the scope of this
manual. Refer to the Nowforever manual that came with the drive for more
information on the drive parameters.

Some parameters to change to allow communication over Modbus.

* P0-000 (Select command source) must be set to communication = 2
* P0-002 (Main frequency source selection) must be set to communication = 6
* P0-055 (Local address) default is 1, change as needed
* P0-056 (Baud rate) default is 9600 bps, change as needed
* P0-057 (Data format) default is 8 data bits, no parity, 1 stop bits,
   change as needed


[NOTE]
To protect the spindle you may wish to set a lower frequency limit. This can be done within the VFD
with parameter P0-008 (Lower limit frequency).

